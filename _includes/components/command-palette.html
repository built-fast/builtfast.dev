{% comment %}
  Command Palette Component

  A power-user focused command palette with:
  - Cmd+K or / to open
  - Keyword matching search
  - Arrow key navigation within results
  - g-prefix sequences for direct navigation (gt→team, ga→api, etc.)
  - Grouped results by category

  Dependencies:
  - Alpine.js
  - /assets/js/command-palette.js
  - /assets/css/_command-palette.css
{% endcomment %}

<!-- Command Palette -->
<template x-if="$store.commandPalette.open">
  <div
    x-data
    @keydown.escape.window="$store.commandPalette.hide()"
  >
    <!-- Backdrop -->
    <div
      class="cmd-palette-backdrop"
      @click="$store.commandPalette.hide()"
      aria-hidden="true"
    ></div>

    <!-- Panel -->
    <div
      class="cmd-palette"
      role="dialog"
      aria-modal="true"
      aria-label="Command palette"
    >
      <!-- Search input -->
      <header class="cmd-palette-header">
        <div class="cmd-palette-search">
          <svg class="cmd-palette-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.3-4.3"/>
          </svg>
          <input
            type="text"
            class="cmd-palette-input"
            placeholder="Search commands..."
            x-model="$store.commandPalette.query"
            x-ref="searchInput"
            @input="$store.commandPalette.selectFirst()"
            x-init="$nextTick(() => $refs.searchInput.focus())"
            autocomplete="off"
            spellcheck="false"
          >
          <span class="cmd-palette-esc">esc</span>
        </div>
      </header>

      <!-- Results -->
      <div class="cmd-palette-results">
        <template x-if="$store.commandPalette.getFilteredCommands().length === 0">
          <div class="cmd-palette-empty" role="status" aria-live="polite">
            No commands found
          </div>
        </template>

        <template x-for="(commands, category) in $store.commandPalette.getGroupedCommands()" :key="category">
          <div class="cmd-palette-group">
            <div class="cmd-palette-group-label" x-text="category"></div>
            <template x-for="cmd in commands" :key="cmd.id">
              <div
                class="cmd-palette-item"
                :class="{ 'selected': cmd.id === $store.commandPalette.selectedId }"
                :data-cmd-id="cmd.id"
                @click="$store.commandPalette.execute(cmd)"
                @mouseenter="$store.commandPalette.selectedId = cmd.id"
              >
                <div class="cmd-palette-item-left">
                  <!-- External link icon -->
                  <svg x-show="cmd.external" class="cmd-palette-item-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M15 3h6v6"/>
                    <path d="M10 14 21 3"/>
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                  </svg>
                  <!-- Action/settings icon -->
                  <svg x-show="cmd.action && !cmd.external" class="cmd-palette-item-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                  </svg>
                  <!-- Internal page icon -->
                  <svg x-show="!cmd.action && !cmd.external" class="cmd-palette-item-icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                    <polyline points="14 2 14 8 20 8"/>
                  </svg>
                  <span class="cmd-palette-item-text" x-text="cmd.title"></span>
                </div>
                <template x-if="cmd.shortcut">
                  <div class="cmd-palette-shortcut">
                    <template x-for="(char, i) in cmd.shortcut.split('')" :key="i">
                      <span class="cmd-palette-key" x-text="char"></span>
                    </template>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </template>
      </div>

      <!-- Footer hints -->
      <footer class="cmd-palette-footer">
        <div class="cmd-palette-hints">
          <div class="cmd-palette-hint">
            <span class="cmd-palette-hint-key">↑↓</span>
            <span>navigate</span>
          </div>
          <div class="cmd-palette-hint">
            <span class="cmd-palette-hint-key">enter</span>
            <span>select</span>
          </div>
        </div>
        <div class="cmd-palette-hint">
          <span class="cmd-palette-hint-key">g?</span>
          <span>shortcuts</span>
        </div>
      </footer>
    </div>
  </div>
</template>

<!-- G-prefix indicator -->
<template x-if="$store.commandPalette.gPrefixActive">
  <div class="cmd-palette-g-indicator" role="status" aria-live="polite">
    <kbd>g</kbd>
    <span>waiting...</span>
  </div>
</template>
